name: CI

on:
  push:
    branches:
      - main

jobs:
    goreleaser-build:
      runs-on: ubuntu-latest
      steps:
        - name: Checkout
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        - name: Set up Go
          uses: actions/setup-go@v5
        - name: Run GoReleaser
          uses: goreleaser/goreleaser-action@v5
          with:
            # either 'goreleaser' (default) or 'goreleaser-pro'
            distribution: goreleaser
            # 'latest', 'nightly', or a semver
            version: latest
            args: build --snapshot --clean
        # env:
            # GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            # Your GoReleaser Pro key, if you are using the 'goreleaser-pro' distribution
            # GORELEASER_KEY: ${{ secrets.GORELEASER_KEY }}
        - uses: actions/upload-artifact@v4
          with:
            name: pinecone_snapshot_${{ github.sha}}_macos
            path: dist/pinecone_amd_pinecone_darwin_amd64_v1/pinecone
            if-no-files-found: error
            retention-days: 7
            compression-level: 0
            overwrite: true
